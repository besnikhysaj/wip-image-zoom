function wipImageZoomConfig(){this.defaults={zoomEnable:!0,defaultIndex:0,images:[],style:"inner",boxPos:"right-top",boxW:400,boxH:400,method:"lens",cursor:"crosshair",lens:!0,zoomLevel:3,immersiveMode:"769",immersiveModeOptions:{},immersiveModeMessage:"Click to Zoom",prevThumbButton:"&#9665;",nextThumbButton:"&#9655;",thumbsPos:"bottom",thumbCol:3,thumbColPadding:4},this.setDefaults=function(e){this.defaults=angular.extend(this.defaults,e)},this.$get=function(){return this}}function wipImageZoomDirective(e){return{restrict:"EA",template:'<div class="wip-image-zoom {{vm.options.style}}-style {{vm.options.thumbsPos}}-thumbs"\n     ng-class="{\n     \'active\':vm.zoomActive, \n     \'immersive-mode\':vm.immersiveModeActive && !immersive,\n     \'zoom-disabled\':!vm.options.zoomEnable,\n     \'box-style\':vm.options.style == \'box\' ,\n     \'inner-style\':vm.options.style == \'inner\'}">\n\n    <wip-image-zoom-thumbs ng-if="vm.options.thumbsPos === \'top\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n\n    <div ng-hide="!vm.options.zoomEnable && immersive" class="main-image-wrapper" ng-class="{\'loading\':vm.largeImageLoading}">\n        <div class="image-zoom-tracker" wip-image-zoom-tracker></div>\n        <div class="image-zoom-lens" wip-image-zoom-lens></div>\n        <img class="main-image" ng-src="{{vm.mainImage.medium}}" image-on-load="vm.initZoom()">\n        <div class="zoom-mask"\n             ng-class="vm.options.style == \'box\'? vm.options.boxPos : \'\'"\n             wip-image-zoom-mask>\n            <img wip-image-zoom-image class="zoom-image main-image-large" image-on-load="vm.largeImageLoaded()"\n                 ng-src="{{vm.mainImage.large}}">\n        </div>\n        <div ng-if="vm.immersiveModeActive && !immersive && vm.options.immersiveModeMessage !== \'\'"\n             class="immersive-mode-message" ng-bind="vm.options.immersiveModeMessage"></div>\n    </div>\n\n    <div class="immersive-no-zoom-image-wrapper" ng-show="!vm.options.zoomEnable && immersive">\n        <img class="main-image-large" ng-src="{{vm.mainImage.large}}">\n    </div>\n\n    <wip-image-zoom-thumbs\n            ng-if="vm.options.thumbsPos === \'bottom\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n</div>',replace:!0,scope:{selectedModel:"=?",selectedIndex:"=?",wipImageZoom:"=",immersive:"=?"},controllerAs:"vm",link:function(e,o,i,m){m.el=o,m.attrs=i,m.init()},controller:["$scope","$document","$window","$compile","wipImageZoomConfig",function(o,i,m,t,n){function s(){S.options=o.wipImageZoom?angular.extend(F,o.wipImageZoom):F,a(),o.selectedIndex=S.options.defaultIndex,o.selectedModel=S.mainImage}function a(){S.options.images.length<=0&&(S.options.images=[{thumb:S.attrs.src,medium:S.attrs.src,large:S.attrs.src}]),S.images=S.options.images,S.mainImage=S.images[S.options.defaultIndex]}function r(){G&&e.cancel(G),G=e(function(){v(),l(),k()},400)}function l(){S.options.zoomEnable&&(f(),S.zoomTracker.style.cursor=S.options.cursor,S.options.lens?S.zoomLens.style.display="block":S.zoomLens.style.display="none",g(),S.immersiveModeActive=S.options.immersiveMode&&S.options.immersiveMode>m.innerWidth||"allways"===S.options.immersiveMode,S.immersiveModeActive&&!o.immersive&&S.zoomTracker.addEventListener("mousedown",u),(!S.immersiveModeActive||o.immersive)&&d())}function d(){S.zoomTracker.addEventListener("mousemove",T),S.zoomTracker.addEventListener("touchstart",T),S.zoomTracker.addEventListener("mouseleave",L),S.zoomTracker.addEventListener("touchend",L),S.zoomTracker.addEventListener("mousemove",I),S.zoomTracker.addEventListener("touchmove",I)}function g(){S.zoomTracker.removeEventListener("mousedown",u),S.zoomTracker.removeEventListener("mousemove",T),S.zoomTracker.removeEventListener("touchstart",T),S.zoomTracker.removeEventListener("mouseleave",L),S.zoomTracker.removeEventListener("touchend",L),S.zoomTracker.removeEventListener("mousemove",I),S.zoomTracker.removeEventListener("touchmove",I)}function c(){i.find("html").removeClass("wip-image-zoom-immersive-mode-enabled"),g(),S.immersedEl.remove(),r()}function u(e){e.preventDefault(),e.stopPropagation(),o.$apply(function(){i.find("html").addClass("wip-image-zoom-immersive-mode-enabled");var e=i.find("body").eq(0);S.immersedImageOpt=angular.extend(angular.copy(S.options),S.options.immersiveModeOptions),S.immersedImageOpt.defaultIndex=o.selectedIndex,S.immersedImageOpt.style="inner",S.immersedEl=t('<div class="immersive-wip-image-zoom">\n    <div class="disable-immersive-mode-button" ng-click="vm.disableImmersiveMode()">&#10006;</div>\n    <img src="" wip-image-zoom="vm.immersedImageOpt" immersive="true" selected-index="selectedIndex">\n</div>\n')(o),e.append(S.immersedEl),r()})}function v(){S.images.length<=1||(S.thumbsWrapperWidth=S.thumbsWrapper.clientWidth,S.thumbWidth=Math.round((S.thumbsWrapperWidth+S.options.thumbColPadding)/S.options.thumbCol),S.thumbsWidth=S.thumbWidth*S.images.length,S.maxPosX=S.images.length-S.options.thumbCol,o.$evalAsync(function(){"top"==S.options.thumbsPos?(S.thumbsEl.style.paddingBottom=S.options.thumbColPadding+"px",S.thumbsEl.style.paddingTop=0):(S.thumbsEl.style.paddingTop=S.options.thumbColPadding+"px",S.thumbsEl.style.paddingBottom=0);for(var e=0;e<S.thumbsEl.children.length;e++){var o=S.thumbsEl.children[e];o.style.width=S.thumbWidth+"px",o.style.paddingRight=S.options.thumbColPadding+"px"}}))}function p(){b(S.thumbsPos+1)}function h(){b(S.thumbsPos-1)}function b(e){e=0>e?0:e,e=e>S.maxPosX?S.maxPosX:e,S.thumbsPos=e;var o=S.thumbsPos*S.thumbWidth*-1;S.thumbsEl.style.transform="translate3d("+o+"px, 0px, 0)"}function f(){var e=S.zoomTracker.getBoundingClientRect();D=e.width,C=e.height,W=e.left+m.scrollX,$=e.top+m.scrollY,"box"!=S.options.style||o.immersive?(O=D,B=C,S.zoomMaskEl.style.width="100%",S.zoomMaskEl.style.height="100%"):(O=S.options.boxW,B=S.options.boxH,S.zoomMaskEl.style.width=O+"px",S.zoomMaskEl.style.height=B+"px"),S.options.zoomLevel>1&&(S.zoomImageEl.style.width=D*S.options.zoomLevel+"px",S.zoomImageEl.style.height=C*S.options.zoomLevel+"px"),X=S.zoomImageEl.offsetWidth,q=S.zoomImageEl.offsetHeight,x()}function I(e){e.preventDefault();var o="touchmove"==e.type&&e.touches&&e.touches[0];P=o&&o.pageX||e.pageX,A=o&&o.pageY||e.pageY,E(),"lens"===S.options.method?z():w()}function z(){var e=[(X-O+1*R/j)*[H/D]],o=[(q-B+1*Y/j)*[N/C]];S.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function w(){var e=[(X-O)*[(P-W)/D]],o=[(q-B)*[(A-$)/C]];e=W>P?0:e,o=$>A?0:o,e=P>W+D?X-O:e,o=A>$+C?q-B:o,S.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function x(){j=D/X,R=O*j,Y=B*j,S.zoomLens.style.width=R+"px",S.zoomLens.style.height=Y+"px"}function E(){H=P-W-.5*R,N=A-$-.5*Y,H=H>D-R?D-R:H,H=0>H?0:H,N=N>C-Y?C-Y:N,N=0>N?0:N,S.zoomLens.style.transform="translate3d("+H+"px,"+N+"px,0)"}function k(){if(!(S.images.length<=1)){var e=y(),o=S.thumbsPos+S.options.thumbCol>e&&S.thumbsPos<e;return o?void b(S.thumbsPos):void b(e)}}function y(){for(var e=0;e<S.images.length;e++)if(S.images[e].medium===S.mainImage.medium)return e}function T(){o.$evalAsync(function(){S.zoomActive=!0})}function L(){o.$evalAsync(function(){S.zoomActive=!1})}function Z(e){S.largeImageLoading=!0,S.mainImage=e,o.selectedModel=S.mainImage,o.selectedIndex=S.images.indexOf(S.mainImage)}function M(){S.largeImageLoading=!1}var P,A,D,C,W,$,O,B,X,q,R,Y,H,N,j,S=this,F=angular.copy(n.defaults),G=!0;S.el,S.zoomTracker,S.zoomLens,S.zoomImageEl,S.thumbsWrapper,S.thumbsEl,S.mainImage,S.options,S.images=[],S.zoomActive=!1,S.largeImageLoading=!0,S.prevThumbActive=!1,S.nextThumbActive=!1,S.thumbWidth,S.thumbsWrapperWidth,S.thumbsWidth,S.thumbsPos=0,S.immersiveModeActive,S.init=s,S.initZoom=l,S.initThumbs=v,S.largeImageLoaded=M,S.updateMainImage=Z,S.nextThumb=p,S.prevThumb=h,S.disableImmersiveMode=c,o.$watch("selectedModel",function(e,o){angular.isDefined(e)&&e!==o&&(S.mainImage=e,k())},!0),o.$watch("selectedIndex",function(e,o){angular.isDefined(e)&&e!==o&&(S.mainImage=S.images[e],k())},!0),angular.element(window).on("resize",function(){r()}),m.Ps&&angular.element(document).on("ps-scroll-y",function(){f()}),o.$watch(function(){return{left:S.zoomTracker.getBoundingClientRect().left+m.scrollX,top:S.zoomTracker.getBoundingClientRect().top+m.scrollY}},function(e,o){angular.isDefined(e)&&e!==o&&r()},!0),o.$watch("wipImageZoom",function(e,o){angular.isDefined(e)&&e!==o&&(s(),r())},!0)}]}}function wipImageZoomLensDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomLens=o[0]}}}function wipImageZoomTrackerDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomTracker=o[0]}}}function wipImageZoomMaskDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomMaskEl=o[0]}}}function wipImageZoomImageDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomImageEl=o[0]}}}function wipImageZoomThumbsDirective(){return{restrict:"EA",require:"^wipImageZoom",template:'<div class="thumbs-wrapper" ng-swipe-left="vm.nextThumb()" ng-swipe-right="vm.prevThumb()">\n    <div class="thumbs" >\n        <div class="thumb-wrapper" ng-repeat="image in vm.images">\n            <img ng-src="{{image.thumb}}" ng-click="vm.updateMainImage(image)"\n                 ng-class="{\'selected\': vm.mainImage.thumb === image.thumb}">\n        </div>\n    </div>\n</div>\n<div class="prev-button"\n     ng-if="vm.thumbsPos !== 0"\n     ng-click="vm.prevThumb()"\n     ng-bind-html="vm.options.prevThumbButton">Prev\n</div>\n<div class="next-button"\n     ng-if="vm.thumbsPos !== vm.maxPosX"\n     ng-click="vm.nextThumb()"\n     ng-bind-html="vm.options.nextThumbButton">Next\n</div>',link:function(e,o,i,m){m.thumbsWrapper=o[0].getElementsByClassName("thumbs-wrapper")[0],m.thumbsEl=o[0].getElementsByClassName("thumbs")[0],m.initThumbs()}}}function imageOnLoadDirective(e){return{restrict:"A",link:function(o,i,m){i[0].addEventListener("load",function(){o.$apply(m.imageOnLoad)},!1),i[0].addEventListener("error",function(){e.warn("image could not be loaded")})}}}imageOnLoadDirective.$inject=["$log"],wipImageZoomDirective.$inject=["$timeout"],angular.module("wipImageZoom",["ngSanitize","ngTouch"]).provider("wipImageZoomConfig",wipImageZoomConfig).directive("imageOnLoad",imageOnLoadDirective).directive("wipImageZoom",wipImageZoomDirective).directive("wipImageZoomTracker",wipImageZoomTrackerDirective).directive("wipImageZoomLens",wipImageZoomLensDirective).directive("wipImageZoomMask",wipImageZoomMaskDirective).directive("wipImageZoomImage",wipImageZoomImageDirective).directive("wipImageZoomThumbs",wipImageZoomThumbsDirective);