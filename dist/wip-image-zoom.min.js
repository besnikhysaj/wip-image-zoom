!function(){"use strict";function e(){this.defaults={zoomEnable:!0,defaultIndex:0,images:[],style:"inner",boxPos:"right-top",boxW:400,boxH:400,method:"lens",cursor:"crosshair",lens:!0,zoomLevel:3,immersiveMode:"769",immersiveModeOptions:{},immersiveModeMessage:"Click to Zoom",prevThumbButton:"&#9665;",nextThumbButton:"&#9655;",thumbsPos:"bottom",thumbCol:3,thumbColPadding:4},this.setDefaults=function(e){this.defaults=angular.extend(this.defaults,e)},this.$get=function(){return this}}function o(e){return{restrict:"EA",template:'<div class="wip-image-zoom {{vm.options.style}}-style {{vm.options.thumbsPos}}-thumbs"\n     ng-class="{\n     \'active\':vm.zoomActive, \n     \'immersive-mode\':vm.immersiveModeActive && !immersive,\n     \'zoom-disabled\':!vm.options.zoomEnable,\n     \'box-style\':vm.options.style == \'box\' ,\n     \'inner-style\':vm.options.style == \'inner\'}">\n\n    <wip-image-zoom-thumbs ng-if="vm.options.thumbsPos === \'top\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n\n    <div ng-hide="!vm.options.zoomEnable && immersive" class="main-image-wrapper" ng-class="{\'loading\':vm.largeImageLoading}">\n        <div class="image-zoom-tracker" wip-image-zoom-tracker></div>\n        <div class="image-zoom-lens" wip-image-zoom-lens></div>\n        <img class="main-image" ng-src="{{vm.mainImage.medium}}" image-on-load="vm.initZoom()">\n        <div class="zoom-mask"\n             ng-class="vm.options.style == \'box\'? vm.options.boxPos : \'\'"\n             wip-image-zoom-mask>\n            <img wip-image-zoom-image class="zoom-image main-image-large" image-on-load="vm.largeImageLoaded()"\n                 ng-src="{{vm.mainImage.large}}">\n        </div>\n        <div ng-if="vm.immersiveModeActive && !immersive && vm.options.immersiveModeMessage !== \'\'"\n             class="immersive-mode-message" ng-bind="vm.options.immersiveModeMessage"></div>\n    </div>\n\n    <div class="immersive-no-zoom-image-wrapper" ng-show="!vm.options.zoomEnable && immersive">\n        <img class="main-image-large" ng-src="{{vm.mainImage.large}}">\n    </div>\n\n    <wip-image-zoom-thumbs\n            ng-if="vm.options.thumbsPos === \'bottom\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n</div>',replace:!0,scope:{selectedModel:"=?",selectedIndex:"=?",wipImageZoom:"=",immersive:"=?"},controllerAs:"vm",link:function(e,o,i,t){t.el=o,t.attrs=i,t.init()},controller:["$scope","$document","$window","$compile","wipImageZoomConfig",function(o,i,t,m,n){function s(){U.options=o.wipImageZoom?angular.extend(V,o.wipImageZoom):V,a(),o.selectedIndex=U.options.defaultIndex,o.selectedModel=U.mainImage,W()}function a(){U.options.images.length<=0&&(U.options.images=[{thumb:U.attrs.src,medium:U.attrs.src,large:U.attrs.src}]),U.images=U.options.images,U.mainImage=U.images[U.options.defaultIndex]}function r(){_&&e.cancel(_),_=e(function(){v(),l(),y()},400)}function l(){U.options.zoomEnable&&(b(),U.zoomTracker.style.cursor=U.options.cursor,U.options.lens?U.zoomLens.style.display="block":U.zoomLens.style.display="none",g(),U.immersiveModeActive=U.options.immersiveMode&&U.options.immersiveMode>t.innerWidth||"always"===U.options.immersiveMode,U.immersiveModeActive&&!o.immersive&&U.zoomTracker.addEventListener("mousedown",c),(!U.immersiveModeActive||o.immersive)&&d())}function d(){U.zoomTracker.addEventListener("mousemove",T),U.zoomTracker.addEventListener("touchstart",T),U.zoomTracker.addEventListener("mouseleave",L),U.zoomTracker.addEventListener("touchend",L),U.zoomTracker.addEventListener("mousemove",z),U.zoomTracker.addEventListener("touchmove",z)}function g(){U.zoomTracker.removeEventListener("mousedown",c),U.zoomTracker.removeEventListener("mousemove",T),U.zoomTracker.removeEventListener("touchstart",T),U.zoomTracker.removeEventListener("mouseleave",L),U.zoomTracker.removeEventListener("touchend",L),U.zoomTracker.removeEventListener("mousemove",z),U.zoomTracker.removeEventListener("touchmove",z)}function u(){i.find("html").removeClass("wip-image-zoom-immersive-mode-enabled"),g(),U.immersedEl.remove(),r()}function c(e){e.preventDefault(),e.stopPropagation(),o.$apply(function(){i.find("html").addClass("wip-image-zoom-immersive-mode-enabled");var e=i.find("body").eq(0);U.immersedImageOpt=angular.extend(angular.copy(U.options),U.options.immersiveModeOptions),U.immersedImageOpt.defaultIndex=o.selectedIndex,U.immersedImageOpt.style="inner",U.immersedEl=m('<div class="immersive-wip-image-zoom">\n    <div class="disable-immersive-mode-button" ng-click="vm.disableImmersiveMode()">&#10006;</div>\n    <img src="" wip-image-zoom="vm.immersedImageOpt" immersive="true" selected-index="selectedIndex">\n</div>\n')(o),e.append(U.immersedEl),r()})}function v(){U.images.length<=1||(U.thumbsWrapperWidth=U.thumbsWrapper.clientWidth,U.thumbWidth=Math.round((U.thumbsWrapperWidth+U.options.thumbColPadding)/U.options.thumbCol),U.thumbsWidth=U.thumbWidth*U.images.length,U.maxPosX=U.images.length-U.options.thumbCol,o.$evalAsync(function(){"top"===U.options.thumbsPos?(U.thumbsEl.style.paddingBottom=U.options.thumbColPadding+"px",U.thumbsEl.style.paddingTop=0):(U.thumbsEl.style.paddingTop=U.options.thumbColPadding+"px",U.thumbsEl.style.paddingBottom=0);for(var e=0;e<U.thumbsEl.children.length;e++){var o=U.thumbsEl.children[e];o.style.width=U.thumbWidth+"px",o.style.paddingRight=U.options.thumbColPadding+"px"}}))}function p(){f(U.thumbsPos+1)}function h(){f(U.thumbsPos-1)}function f(e){e=0>e?0:e,e=e>U.maxPosX?U.maxPosX:e,U.thumbsPos=e;var o=U.thumbsPos*U.thumbWidth*-1;U.thumbsEl.style.transform="translate3d("+o+"px, 0px, 0)"}function b(){var e=U.zoomTracker.getBoundingClientRect();O=e.width,X=e.height,D=e.left+t.scrollX,q=e.top+t.scrollY,"box"!==U.options.style||o.immersive?(H=O,R=X,U.zoomMaskEl.style.width="100%",U.zoomMaskEl.style.height="100%"):(H=U.options.boxW,R=U.options.boxH,U.zoomMaskEl.style.width=H+"px",U.zoomMaskEl.style.height=R+"px"),U.zoomImageEl.style.width="",U.zoomImageEl.style.height="",U.options.zoomLevel>1?(U.zoomImageEl.style.width=O*U.options.zoomLevel+"px",U.zoomImageEl.style.height=X*U.options.zoomLevel+"px"):(U.zoomImageEl.offsetWidth<=H||U.zoomImageEl.offsetHeight<=R)&&(U.zoomImageEl.offsetWidth/U.zoomImageEl.offsetHeight>1?(U.zoomImageEl.style.height=1.5*R+"px",U.zoomImageEl.style.width=""):(U.zoomImageEl.style.width=1.5*H+"px",U.zoomImageEl.style.height="")),Y=U.zoomImageEl.offsetWidth,N=U.zoomImageEl.offsetHeight,w()}function z(e){e.preventDefault();var o="touchmove"===e.type&&e.touches&&e.touches[0];$=o&&o.pageX||e.pageX,B=o&&o.pageY||e.pageY,x(),"lens"===U.options.method?I():E()}function I(){var e=[(Y-H+1*j/J)*[F/O]],o=[(N-R+1*S/J)*[G/X]];U.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function E(){var e=[(Y-H)*[($-D)/O]],o=[(N-R)*[(B-q)/X]];e=D>$?0:e,o=q>B?0:o,e=$>D+O?Y-H:e,o=B>q+X?N-R:o,U.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function w(){J=O/Y,j=H*J,S=R*J,U.zoomLens.style.width=j+"px",U.zoomLens.style.height=S+"px"}function x(){F=$-D-.5*j,G=B-q-.5*S,F=F>O-j?O-j:F,F=0>F?0:F,G=G>X-S?X-S:G,G=0>G?0:G,U.zoomLens.style.transform="translate3d("+F+"px,"+G+"px,0)"}function y(){if(!(U.images.length<=1)){var e=k(),o=U.thumbsPos+U.options.thumbCol>e&&U.thumbsPos<e;return o?void f(U.thumbsPos):void f(e)}}function k(){for(var e=0;e<U.images.length;e++)if(U.images[e].medium===U.mainImage.medium)return e}function T(){o.$evalAsync(function(){U.zoomActive=!0})}function L(){o.$evalAsync(function(){U.zoomActive=!1})}function M(e,o){angular.isDefined(e)&&e!==o&&(U.mainImage=e,y())}function P(e,o){angular.isDefined(e)&&e!==o&&(U.mainImage=U.images[e],y())}function A(e){U.largeImageLoading=!0,U.mainImage=e,Z(),o.selectedModel=angular.copy(U.mainImage),o.selectedIndex=U.images.indexOf(U.mainImage),W()}function W(){K=o.$watch("selectedIndex",P,!0),Q=o.$watch("selectedModel",M,!0)}function Z(){Q(),K()}function C(){U.largeImageLoading=!1,b()}var $,B,O,X,D,q,H,R,Y,N,j,S,F,G,J,K,Q,U=this,V=angular.copy(n.defaults),_=!0;U.el={},U.zoomTracker={},U.zoomLens={},U.zoomImageEl={},U.thumbsWrapper={},U.thumbsEl={},U.mainImage={},U.options={},U.images=[],U.zoomActive=!1,U.largeImageLoading=!0,U.prevThumbActive=!1,U.nextThumbActive=!1,U.thumbWidth=0,U.thumbsWrapperWidth=0,U.thumbsWidth=0,U.thumbsPos=0,U.immersiveModeActive=!1,U.init=s,U.initZoom=l,U.initThumbs=v,U.largeImageLoaded=C,U.updateMainImage=A,U.nextThumb=p,U.prevThumb=h,U.disableImmersiveMode=u,angular.element(window).on("resize",function(){r()}),t.Ps&&angular.element(document).on("ps-scroll-y",function(){b()}),o.$watch(function(){return{left:U.zoomTracker.getBoundingClientRect().left+t.scrollX,top:U.zoomTracker.getBoundingClientRect().top+t.scrollY}},function(e,o){angular.isDefined(e)&&e!==o&&r()},!0),o.$watch("wipImageZoom",function(e,o){angular.isDefined(e)&&e!==o&&(s(),r())},!0)}]}}function i(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomLens=o[0]}}}function t(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomTracker=o[0]}}}function m(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomMaskEl=o[0]}}}function n(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomImageEl=o[0]}}}function s(){return{restrict:"EA",require:"^wipImageZoom",template:'<div class="thumbs-wrapper" ng-swipe-left="vm.nextThumb()" ng-swipe-right="vm.prevThumb()">\n    <div class="thumbs" >\n        <div class="thumb-wrapper" ng-repeat="image in vm.images">\n            <img ng-src="{{image.thumb}}" ng-click="vm.updateMainImage(image)"\n                 ng-class="{\'selected\': vm.mainImage.thumb === image.thumb}">\n        </div>\n    </div>\n</div>\n<div class="prev-button"\n     ng-if="vm.thumbsPos !== 0"\n     ng-click="vm.prevThumb()"\n     ng-bind-html="vm.options.prevThumbButton">Prev\n</div>\n<div class="next-button"\n     ng-if="vm.thumbsPos !== vm.maxPosX && vm.images.length > vm.options.thumbCol"\n     ng-click="vm.nextThumb()"\n     ng-bind-html="vm.options.nextThumbButton">Next\n</div>',link:function(e,o,i,t){t.thumbsWrapper=o[0].getElementsByClassName("thumbs-wrapper")[0],t.thumbsEl=o[0].getElementsByClassName("thumbs")[0],t.initThumbs()}}}function a(e){return{restrict:"A",link:function(o,i,t){i[0].addEventListener("load",function(){o.$apply(t.imageOnLoad)},!1),i[0].addEventListener("error",function(){e.warn("image could not be loaded")})}}}a.$inject=["$log"],o.$inject=["$timeout"],angular.module("wipImageZoom",["ngSanitize","ngTouch"]).provider("wipImageZoomConfig",e).directive("imageOnLoad",a).directive("wipImageZoom",o).directive("wipImageZoomTracker",t).directive("wipImageZoomLens",i).directive("wipImageZoomMask",m).directive("wipImageZoomImage",n).directive("wipImageZoomThumbs",s)}();