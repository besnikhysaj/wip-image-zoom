function wipImageZoomDirective(e){return{restrict:"EA",template:imageZoomTemplate,replace:!0,scope:{selectedModel:"=?",selectedIndex:"=?",wipImageZoom:"=",immersive:"=?"},controllerAs:"vm",link:function(e,o,i,t){t.el=o,t.init()},controller:["$scope","$document","$window","$compile",function(o,i,t,m){function n(){N.options=o.wipImageZoom?angular.extend(Y,o.wipImageZoom):Y,N.images=N.options.images,N.mainImage=N.images[N.options.defaultIndex],o.selectedIndex=N.options.defaultIndex,o.selectedModel=N.mainImage}function s(){j&&e.cancel(j),j=e(function(){c(function(){a(),E()})},400)}function a(){h(),N.zoomTracker.style.cursor=N.options.cursor,N.options.lens?N.zoomLens.style.display="block":N.zoomLens.style.display="none",d(),N.immersiveModeActive=N.options.immersiveMode&&N.options.immersiveMode>t.innerWidth,N.immersiveModeActive&&!o.immersive&&N.zoomTracker.addEventListener("mousedown",u),(!N.immersiveModeActive||o.immersive)&&r()}function r(){N.zoomTracker.addEventListener("mousemove",x),N.zoomTracker.addEventListener("touchstart",x),N.zoomTracker.addEventListener("mouseleave",y),N.zoomTracker.addEventListener("touchend",y),N.zoomTracker.addEventListener("mousemove",b),N.zoomTracker.addEventListener("touchmove",b)}function d(){N.zoomTracker.removeEventListener("mousedown",u),N.zoomTracker.removeEventListener("mousemove",x),N.zoomTracker.removeEventListener("touchstart",x),N.zoomTracker.removeEventListener("mouseleave",y),N.zoomTracker.removeEventListener("touchend",y),N.zoomTracker.removeEventListener("mousemove",b),N.zoomTracker.removeEventListener("touchmove",b)}function l(){i.find("html").removeClass("wip-image-zoom-immersive-mode-enabled"),d(),N.immersedEl.remove(),s()}function u(e){e.preventDefault(),e.stopPropagation(),o.$apply(function(){i.find("html").addClass("wip-image-zoom-immersive-mode-enabled");var e=i.find("body").eq(0);N.immersedImageOpt=angular.copy(N.options),N.immersedImageOpt.style="inner",N.immersedImageOpt.defaultIndex=o.selectedIndex,N.immersedEl=m('<div class="immersive-wip-image-zoom">\n    <div class="disable-immersive-mode-button" ng-click="vm.disableImmersiveMode()">\n        &#10006;</div>\n    <img src="" wip-image-zoom="vm.immersedImageOpt" immersive="true" selected-index="selectedIndex">\n</div>\n')(o),e.append(N.immersedEl),s()})}function c(e){p(0),N.thumbsWrapperWidth=N.thumbsWrapper.clientWidth,N.thumbWidth=Math.round((N.thumbsWrapperWidth+N.options.thumbColPadding)/N.options.thumbCol),N.thumbsWidth=N.thumbWidth*N.images.length,o.$evalAsync(function(){N.thumbsPosX=0,"top"==N.options.thumbsPos?(N.thumbsEl.style.paddingBottom=N.options.thumbColPadding+"px",N.thumbsEl.style.paddingTop=0):(N.thumbsEl.style.paddingTop=N.options.thumbColPadding+"px",N.thumbsEl.style.paddingBottom=0);for(var o=0;o<N.thumbsEl.children.length;o++){var i=N.thumbsEl.children[o];i.style.width=N.thumbWidth+"px",i.style.paddingRight=N.options.thumbColPadding+"px"}return e?e():void 0})}function v(){N.thumbsPosX=N.thumbsPosX+N.thumbWidth,p(-1*N.thumbsPosX)}function g(){N.thumbsPosX=N.thumbsPosX-N.thumbWidth,p(-1*N.thumbsPosX)}function p(e,o){e=e||0,o=o||0,N.thumbsEl.style.transform="translate3d("+e+"px,"+o+"px, 0)"}function h(){var e=N.zoomTracker.getBoundingClientRect();M=e.width,P=e.height,W=e.left+t.scrollX,A=e.top+t.scrollY,"box"!=N.options.style||o.immersive?(D=M,X=P,N.zoomMaskEl.style.width="100%",N.zoomMaskEl.style.height="100%"):(D=N.options.boxW,X=N.options.boxH,N.zoomMaskEl.style.width=D+"px",N.zoomMaskEl.style.height=X+"px"),N.options.zoomLevel>1&&(N.zoomImageEl.style.width=M*N.options.zoomLevel+"px",N.zoomImageEl.style.height=P*N.options.zoomLevel+"px"),C=N.zoomImageEl.offsetWidth,$=N.zoomImageEl.offsetHeight,z()}function b(e){e.preventDefault();var o="touchmove"==e.type&&e.touches&&e.touches[0];L=o&&o.pageX||e.pageX,Z=o&&o.pageY||e.pageY,w(),"lens"===N.options.method?f():I()}function f(){var e=[(C-D+1*B/H)*[q/M]],o=[($-X+1*O/H)*[R/P]];N.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function I(){var e=[(C-D)*[(L-W)/M]],o=[($-X)*[(Z-A)/P]];e=W>L?0:e,o=A>Z?0:o,e=L>W+M?C-D:e,o=Z>A+P?$-X:o,N.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function z(){H=M/C,B=D*H,O=X*H,N.zoomLens.style.width=B+"px",N.zoomLens.style.height=O+"px"}function w(){q=L-W-.5*B,R=Z-A-.5*O,q=q>M-B?M-B:q,q=0>q?0:q,R=R>P-O?P-O:R,R=0>R?0:R,N.zoomLens.style.transform="translate3d("+q+"px,"+R+"px,0)"}function E(){var e=k(),o=N.thumbsEl.children[e],i=N.thumbsPosX<=o.offsetLeft&&o.offsetLeft<N.thumbsPosX+N.thumbsWrapperWidth;i||(N.thumbsPosX=o.offsetLeft,N.thumbsWidth-N.thumbsPosX<=N.thumbsWrapperWidth&&(N.thumbsPosX=N.thumbWidth*(N.options.images.length-N.options.thumbCol)),p(-1*N.thumbsPosX))}function k(){for(var e=0;e<N.images.length;e++)if(N.images[e].medium===N.mainImage.medium)return e}function x(){o.$evalAsync(function(){N.zoomActive=!0})}function y(){o.$evalAsync(function(){N.zoomActive=!1})}function T(e){N.mainImage=e,o.selectedModel=N.mainImage,o.selectedIndex=N.images.indexOf(N.mainImage)}var L,Z,M,P,W,A,D,X,C,$,B,O,q,R,H,N=this,Y={defaultIndex:0,images:[],style:"inner",boxPos:"right-top",boxW:400,boxH:400,method:"lens",cursor:"crosshair",lens:!0,zoomLevel:3,immersiveMode:769,immersiveModeMessage:"Click to Zoom",prevThumbButton:"&#9665;",nextThumbButton:"&#9655;",thumbsPos:"bottom",thumbCol:3,thumbColPadding:4},j=!0;N.el,N.zoomTracker,N.zoomLens,N.zoomImageEl,N.thumbsWrapper,N.thumbsEl,N.mainImage,N.options,N.images=[],N.zoomActive=!1,N.prevThumbActive=!1,N.nextThumbActive=!1,N.thumbWidth,N.thumbsWrapperWidth,N.thumbsWidth,N.thumbsPosX,N.immersiveModeActive,N.init=n,N.initZoom=a,N.initThumbs=c,N.updateMainImage=T,N.nextThumb=v,N.prevThumb=g,N.disableImmersiveMode=l,o.$watch("selectedModel",function(e,o){angular.isDefined(e)&&e!==o&&(N.mainImage=e,E())},!0),o.$watch("selectedIndex",function(e,o){angular.isDefined(e)&&e!==o&&(N.mainImage=N.images[e],E())},!0),angular.element(window).on("resize",function(){s()}),o.$watch(function(){return{left:N.zoomTracker.getBoundingClientRect().left,top:N.zoomTracker.getBoundingClientRect().top}},function(e,o){angular.isDefined(e)&&e!==o&&s()},!0),o.$watch("wipImageZoom",function(e,o){angular.isDefined(e)&&e!==o&&(n(),s())},!0)}]}}function wipImageZoomLensDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomLens=o[0]}}}function wipImageZoomTrackerDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomTracker=o[0]}}}function wipImageZoomMaskDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomMaskEl=o[0]}}}function wipImageZoomImageDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,t){t.zoomImageEl=o[0]}}}function wipImageZoomThumbsDirective(){return{restrict:"EA",require:"^wipImageZoom",template:'<div class="thumbs-wrapper">\n    <div class="thumbs">\n        <div class="thumb-wrapper" ng-repeat="image in vm.images">\n            <img ng-src="{{image.thumb}}" ng-click="vm.updateMainImage(image)"\n                 ng-class="{\'selected\': vm.mainImage.thumb === image.thumb}">\n        </div>\n    </div>\n</div>\n<div class="prev-button" ng-if="vm.thumbsPosX !== 0"\n     ng-click="vm.prevThumb()"\n     ng-bind-html="vm.options.prevThumbButton">Prev\n</div>\n<div class="next-button"\n     ng-if="vm.thumbsPosX < vm.thumbWidth * (vm.options.images.length - vm.options.thumbCol)"\n     ng-click="vm.nextThumb()"\n     ng-bind-html="vm.options.nextThumbButton">Next\n</div>',link:function(e,o,i,t){t.thumbsWrapper=o[0].getElementsByClassName("thumbs-wrapper")[0],t.thumbsEl=o[0].getElementsByClassName("thumbs")[0],t.initThumbs()}}}function imageOnLoadDirective(e){return{restrict:"A",link:function(o,i,t){i[0].addEventListener("load",function(){o.$apply(t.imageOnLoad)},!1),i[0].addEventListener("error",function(){e.warn("image could not be loaded")})}}}imageOnLoadDirective.$inject=["$log"],wipImageZoomDirective.$inject=["$timeout"],angular.module("wipImageZoom",["ngSanitize"]).directive("imageOnLoad",imageOnLoadDirective).directive("wipImageZoom",wipImageZoomDirective).directive("wipImageZoomTracker",wipImageZoomTrackerDirective).directive("wipImageZoomLens",wipImageZoomLensDirective).directive("wipImageZoomMask",wipImageZoomMaskDirective).directive("wipImageZoomImage",wipImageZoomImageDirective).directive("wipImageZoomThumbs",wipImageZoomThumbsDirective);var imageZoomTemplate='<div class="wip-image-zoom {{vm.options.style}}-style {{vm.options.thumbsPos}}-thumbs"\n     ng-class="{\n     \'active\':vm.zoomActive, \n     \'immersive-mode\':vm.immersiveModeActive && !immersive,\n     \'box-style\':vm.options.style == \'box\' ,\n     \'inner-style\':vm.options.style == \'inner\'}">\n\n    <wip-image-zoom-thumbs ng-if="vm.options.thumbsPos === \'top\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n\n    <div class="main-image-wrapper">\n        <div class="image-zoom-tracker" wip-image-zoom-tracker></div>\n        <div class="image-zoom-lens" wip-image-zoom-lens></div>\n        <img class="main-image" ng-src="{{vm.mainImage.medium}}">\n        <div class="zoom-mask"\n             ng-class="vm.options.style == \'box\' ? vm.options.boxPos:\'\'"\n             wip-image-zoom-mask>\n            <img wip-image-zoom-image class="zoom-image main-image-large"\n                 ng-src="{{vm.mainImage.large}}" image-on-load="vm.initZoom()">\n        </div>\n        <div ng-if="vm.immersiveModeActive && !immersive && vm.options.immersiveModeMessage !== \'\'"\n             class="immersive-mode-message" ng-bind="vm.options.immersiveModeMessage"></div>\n    </div>\n\n    <wip-image-zoom-thumbs\n            ng-if="vm.options.thumbsPos === \'bottom\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n</div>';